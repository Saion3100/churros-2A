<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>ãƒã‚¸ãƒãƒ¥ãƒ­ ç®¡ç†ãƒšãƒ¼ã‚¸</title>
  <style>
    body {
      font-family: "Hiragino Sans", sans-serif;
      text-align: center;
      background: #fff8f0;
      color: #333;
      padding: 30px;
    }

    h1 {
      color: #d17b00;
      margin-bottom: 20px;
    }

    .lists-container {
      display: flex;
      justify-content: space-between;
      /* å·¦å³ã«åºƒã’ã‚‹ */
      gap: 0.5em;
      /* ãƒœãƒƒã‚¯ã‚¹é–“ã®éš™é–“ */
      margin-top: 20px;
    }

    .list-box {
      flex: 1;
      /* æ¨ªå¹…ã„ã£ã±ã„ã«å‡ç­‰å‰²ã‚Š */
      max-width: 49%;
      /* å°‘ã—ä½™ç™½ã‚’æ®‹ã™ */
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      min-width: 120px;
    }

    /* âœ… å‘¼ã³å‡ºã—æ¸ˆã¿ãƒœãƒƒã‚¯ã‚¹ã‚’æ¨ª2åˆ—åˆ†ã®å¹…ã« */
    .completed-wrapper {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .completed-box {
      width: calc(100% - 0.5em);
      /* ä¸Š2ã¤ã®éš™é–“åˆ†ã‚’å·®ã—å¼•ã */
      max-width: 100%;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }


    .ticket {
      display: inline-block;
      background-color: #ffffff;
      border: 3px solid #f4a300;
      border-radius: 6px;
      padding: 10px 20px;
      margin: 5px;
      font-size: 1.5em;
      font-weight: bold;
      cursor: pointer;
    }

    .ticket:hover {
      background-color: #ffd180;
    }

    button {
      background: #ffb347;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      margin-top: 20px;
      cursor: pointer;
      font-size: 1em;
    }

    button:hover {
      background-color: #ffa41b;
    }

    /* ã‚¹ãƒãƒ›ã§ã‚‚æ¨ªä¸¦ã³ç¶­æŒ */
    @media (max-width: 500px) {
      .lists-container {
        flex-direction: row;
      }

      .list-box {
        max-width: 48%;
        padding: 18px;
      }


      .ticket {
        font-size: 1.4em;
        padding: 1em 1.5em;
        margin: 0.5em 0.3em;
      }

      button {
        font-size: 1.2em;
        padding: 1em 2em;
      }

      .completed-box {
        width: 100%;
        padding: 18px;
      }
    }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      databaseURL: "https://churros-2a-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const ticketsRef = ref(db, "tickets");
    const callingList = document.getElementById("callingList");
    const waitingList = document.getElementById("waitingList");
    const clearAllBtn = document.getElementById("clearAll");
    const completedList = document.getElementById("completedList");

    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒã‚±ãƒƒãƒˆæƒ…å ±ã‚’å–å¾—
    onValue(ticketsRef, (snapshot) => {
      const data = snapshot.val() || {};
      const waiting = [];
      const calling = [];
      for (const [key, val] of Object.entries(data)) {
        if (val.status === "waiting") waiting.push({ key, ...val });
        else if (val.status === "calling") calling.push({ key, ...val });
      }
      renderList(waitingList, waiting, "waiting");
      renderList(callingList, calling, "calling");
    });

    function renderList(container, list, type) {
      container.innerHTML = "";
      if (list.length === 0) {
        container.innerHTML = "<p>ãªã—</p>";
        return;
      }
      list.sort((a, b) => a.number - b.number);
      list.forEach(item => {
        const div = document.createElement("div");
        div.className = "ticket";
        div.textContent = item.number;
        div.addEventListener("click", async () => {
          if (type === "waiting") {
            if (confirm(`${item.number}ç•ªã‚’å‘¼ã³å‡ºã—ã¾ã™ã‹ï¼Ÿ`)) {
              await update(ref(db, `tickets/${item.key}`), { status: "calling" });
            }
          } else if (type === "calling") {
            if (confirm(`${item.number}ç•ªã®å•†å“ã‚’å—ã‘æ¸¡ã—ã¾ã—ãŸã‹ï¼Ÿ`)) {
              await remove(ref(db, `tickets/${item.key}`));

              // å‘¼ã³å‡ºã—æ¸ˆã¿ä¸€è¦§ã«è¿½åŠ è¡¨ç¤º
              const div = document.createElement("div");
              div.className = "ticket";
              div.textContent = item.number;
              completedList.prepend(div); // æœ€æ–°ã‚’ä¸Šã«
            }
          }
        });
        container.appendChild(div);
      });
    }



    // clearAllBtn.addEventListener("click", async () => {
    //   if (confirm("å…¨ãƒã‚±ãƒƒãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
    //     await remove(ticketsRef);
    //   }
    // });
  </script>
</head>

<body>
  <h1> ãƒã‚¸ã‚«ãƒ«ãƒãƒ¥ãƒ­ãƒªãƒãƒƒãƒ— <br> ç®¡ç†ãƒšãƒ¼ã‚¸ </h1>
  <p>ï¼‘ï¼å¾…æ©Ÿä¸­ã®å‘¼ã³å‡ºã—ç•ªå·ã‚’ã‚¿ãƒƒãƒ—<br>
    ï¼’ï¼å•†å“å—ã‘æ¸¡ã—å¾Œã€å‘¼ã³å‡ºã—ä¸­ç•ªå·ã‚’ã‚¿ãƒƒãƒ—
  </p>

  <div class="lists-container">
    <div class="list-box">
      <h2>ğŸ“£ å‘¼ã³å‡ºã—ä¸­</h2>
      <div id="callingList"></div>
    </div>

    <div class="list-box">
      <h2>â³ å¾…æ©Ÿä¸­</h2>
      <div id="waitingList"></div>
    </div>
  </div>

  <div class="completed-wrapper">
    <div class="completed-box">
      <h2>âœ… å‘¼ã³å‡ºã—æ¸ˆã¿</h2>
      <div id="completedList"></div>
    </div>
  </div>

  <!-- <button id="clearAll">ã™ã¹ã¦å‰Šé™¤ ğŸ§¹</button> -->
</body>

</html>